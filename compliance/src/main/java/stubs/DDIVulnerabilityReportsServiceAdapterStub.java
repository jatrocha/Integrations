package stubs;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.FilenameFilter;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import org.apache.commons.lang.StringUtils;

import br.com.cygnus.framework.util.PropertiesUtil;

import com.modulo.integrations.ddi.adapter.DDIVulnerabilityReportsServiceAdapter;

public class DDIVulnerabilityReportsServiceAdapterStub extends DDIVulnerabilityReportsServiceAdapter {

   @Override
   public Map<String, StringBuffer> list() throws IOException {

      final Map<String, StringBuffer> reports = new HashMap<String, StringBuffer>();

      final String filePath = PropertiesUtil.getInstance().getString("DDI.Report.XML.Stub");

      final String[] files = new File(filePath).list(new FilenameFilter() {

         @Override
         public boolean accept(File dir, String name) {

            return StringUtils.contains(name, "xml");
         }
      });

      for (final String fileName : files) {

         final BufferedReader reader = new BufferedReader(new FileReader(filePath.concat(fileName)));

         final StringBuffer buffer = new StringBuffer();

         while (reader.ready()) {

            buffer.append(reader.readLine().trim());
         }

         reader.close();

         reports.put(fileName, buffer);
      }

      return reports;
   }

}
