package com.modulo.integrations.commons.ddi.converter;

import br.com.cygnus.framework.template.business.converter.Converter;

import com.modulo.integrations.ddi.to.Host;
import com.modulo.integrations.ddi.to.Vulnerability;
import com.modulo.riskmanager.client.to.event.Event;

public class VulnerabilityToEventConverter implements Converter<Vulnerability, Event> {

   private Host host;

   @Override
   public Event convert(final Vulnerability source) {

      if (source == null) {

         throw new IllegalArgumentException();
      }

      final Event target = new Event();

      target.setTitle(source.getTitle());

      target.getCustomAttributes().put("risk_level", source.getRiskLevel());

      target.getCustomAttributes().put("vulnerability_status", source.getStatus());

      target.getCustomAttributes().put("first_discovery_date", source.getFirstDiscoveryDate());

      target.getCustomAttributes().put("lastfixed", source.getLastFixedDate());

      target.getCustomAttributes().put("manually_added", source.getManuallyAdded());

      target.getCustomAttributes().put("cvssScore", source.getCvssScore());

      target.getCustomAttributes().put("vulnerability_id", source.getVulnerabilityId());

      target.getCustomAttributes().put("vulnerability_type_id", source.getVulnerabilityTypeId());

      target.setDescription(source.getData());

      target.getCustomAttributes().put("vulnerability_description", source.getData());

      target.getCustomAttributes().put("vuln_data_was_truncated", source.getVulnDataWasTruncated());

      target.getCustomAttributes().put("new_vulnerability_solution", source.getSolution());

      target.getCustomAttributes().put("network_protocol", source.getNetworkProtocol());

      target.getCustomAttributes().put("application_protocol", source.getApplicationProtocol());

      target.getCustomAttributes().put("application_port", source.getPort());

      target.getCustomAttributes().put("ipaddress", this.host.getIpAddress());

      target.getCustomAttributes().put("hostname", this.host.getName());

      target.getCustomAttributes().put("operating_system", this.host.getOperatingSystem());

      target.getCustomAttributes().put("parent_ip", this.host.getParentIp());

      return target;
   }

   public VulnerabilityToEventConverter with(final Host host) {

      this.host = host;

      return this;
   }

}
